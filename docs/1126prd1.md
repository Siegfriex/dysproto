# 📅 1126 PRD v1.0: Multi-Persona Design Intelligence System

**작성일**: 2025-11-26  
**문서 버전**: 1.0 (New Paradigm)  
**기반 문서**: `1126planning.md`, `style_collection_strategy.md`, `dna_synthesis_search_algo.md`

---

## 1. 프로젝트 개요 (Project Overview)

**DYSS (Design Intelligence Support System)**는 단순한 디자인 분석 도구를 넘어, 디자이너의 **"다중 페르소나(Multi-Persona)"**를 관리하고 활용하는 지능형 에이전트로 진화합니다.

### 1.1 핵심 가치 제안 (Value Proposition)
*   **From**: "내 디자인 점수는 몇 점이지?" (단발성 평가)
*   **To**: "**내 미니멀리즘 컬렉션**을 기반으로 레퍼런스를 찾아줘." (자산화 및 활용)

### 1.2 패러다임 전환
1.  **Source of Truth**: 단일 이미지 → **Style Collection (작업물 집합)**
2.  **Intelligence**: 단순 메트릭 분석 → **Synthesized DNA (정규화된 스타일 벡터)**
3.  **Interaction**: 텍스트 검색 → **Context-aware Search & Generation**

---

## 2. 현황 및 목표 (Status & Goals)

### 2.1 현재 상태 (As-Is)
*   **Core**: 이미지 업로드 및 Gemini 기반 5축 분석 완료.
*   **Data**: `analyses` 컬렉션에 개별 문서로 저장됨.
*   **Search**: Google Custom Search API 의존 (단순 키워드 매칭).
*   **User**: `users` 컬렉션 존재하나, 스타일 프로파일링 부재.

### 2.2 목표 상태 (To-Be)
*   **Collection**: 사용자가 의도를 갖고 그룹핑한 `styleCollections` 구축.
*   **Synthesis**: 컬렉션별로 **DNA(Vector + Stats)** 자동 합성.
*   **Application**: 검색/생성 시 특정 컬렉션을 **Source**로 주입하여 개인화된 결과 제공.

---

## 3. 기능 요구사항 (Functional Requirements)

### 3.1 스타일 컬렉션 관리 (Style Collection Management)
*   **FR-C1 (Batch Upload)**: 사용자는 폴더 드래그 앤 드롭으로 10장 이상의 이미지를 한 번에 업로드할 수 있어야 한다.
*   **FR-C2 (Collection Creation)**: 업로드 직후 또는 기존 라이브러리에서 선택하여 "새 컬렉션 만들기"를 할 수 있어야 한다.
*   **FR-C3 (Smart Grouping)**: (Phase 3) AI가 유저의 전체 작업물을 분석하여 "유사한 스타일 그룹"을 자동으로 제안해야 한다.

### 3.2 DNA 합성 엔진 (DNA Synthesis Engine)
*   **FR-D1 (Vector Synthesis)**: 컬렉션 내 작업물들의 임베딩을 가중 평균(Weighted Centroid)하여 대표 벡터를 생성해야 한다.
*   **FR-D2 (Metric Profiling)**: 5축 메트릭의 평균, 표준편차, 일관성 점수를 산출해야 한다.
*   **FR-D3 (Color/Keyword)**: K-Means++ 클러스터링으로 대표 색상 팔레트를 추출하고, TF-IDF로 핵심 키워드를 도출해야 한다.
*   **FR-D4 (Incremental Update)**: 새 작업물 추가 시 전체 재계산 없이 증분 업데이트(Incremental Update)가 가능해야 한다.

### 3.3 컬렉션 기반 검색 및 생성 (Context-aware Application)
*   **FR-S1 (Source Selector)**: 검색창 옆에 "Source: [Global DNA] / [Collection A] / [Collection B]" 선택 UI를 제공해야 한다.
*   **FR-S2 (Hybrid Search)**: 선택된 DNA 벡터와 텍스트 쿼리를 결합하여 하이브리드 검색을 수행해야 한다.
*   **FR-S3 (Diversity Control)**: MMR 알고리즘을 통해 결과의 다양성(Diversity)을 0~100%로 조절할 수 있어야 한다.

---

## 4. 기술 명세 (Technical Specifications)

### 4.1 데이터 모델 (Firestore Schema)

#### `styleCollections/{collectionId}`
```typescript
interface StyleCollection {
  id: string;
  userId: string;
  name: string;       // e.g., "2024 Portfolio"
  analysisIds: string[];
  
  // 합성된 DNA (핵심 자산)
  synthesizedDNA: {
    styleVector: number[];      // 768-dim embedding
    metricsDistribution: {      // 메트릭 통계
      layout: { mean: 82, stdDev: 5.2, consistency: 90 },
      // ... others
    };
    colorProfile: {             // 색상 프로파일
      dominantPalette: [{ hex: "#FF5733", weight: 0.4 }, ...];
      temperature: "warm";
    };
    keywordProfile: {           // 키워드 프로파일
      topKeywords: [{ keyword: "minimal", score: 0.8 }, ...];
    };
    qualityScore: number;       // DNA 신뢰도 (0-100)
  };
  
  metadata: {
    createdAt: Timestamp;
    lastSynthesizedAt: Timestamp;
  };
}
```

### 4.2 핵심 알고리즘 (Algorithms)

#### A. DNA 합성 파이프라인
1.  **Load**: `analyses` 로드 및 유효성 검증 (Min 5 items).
2.  **Preprocess**: Modified Z-Score로 이상치(Outlier) 제거, 지수 감쇠(Exponential Decay)로 시간 가중치 계산.
3.  **Compute**:
    *   Vector: $\vec{C} = \frac{\sum w_i \vec{v}_i}{\sum w_i}$
    *   Color: K-Means++ Clustering ($k=5$)
4.  **Persist**: Firestore 저장 및 캐싱.

#### B. 검색 파이프라인 (MMR)
$$ MMR = \lambda \cdot Sim(d, q) - (1-\lambda) \cdot \max_{d_i \in S} Sim(d, d_i) $$
*   $\lambda$: Diversity Level (유저 조절 가능)
*   $q$: Collection DNA Vector + Text Query Vector

---

## 5. 구현 로드맵 (Implementation Roadmap)

### Phase 1: Foundation (기간: 2주)
**목표**: 컬렉션 구조 생성 및 대량 업로드 구현
*   [Backend] `styleCollections` CRUD API 구현.
*   [Frontend] `react-dropzone` 기반 Batch Upload UI 구현.
*   [Frontend] 업로드 후 "Add to Collection" 모달 구현.
*   [Backend] `analyses` 문서에 `embedding` 필드 추가 (Gemini API 연동).

### Phase 2: Intelligence (기간: 3주)
**목표**: DNA 합성 엔진 및 벡터 검색 구현
*   [Backend] `synthesizeCollectionDNA` Cloud Function 구현 (알고리즘 탑재).
*   [Backend] Firestore Vector Search 인덱스 설정.
*   [Backend] `searchByCollection` API 구현 (Basic Vector Search).
*   [Frontend] Collection Detail 페이지 (DNA 시각화: Radar Chart, Color Palette).

### Phase 3: Application & Polish (기간: 3주)
**목표**: 검색/생성 UX 완성 및 고도화
*   [Frontend] 검색 페이지 리팩토링 (Source Selector, Diversity Slider 추가).
*   [Backend] MMR 알고리즘 및 재랭킹 로직 적용.
*   [Frontend] "Generate with this Style" 기능 구현 (Prompt Context Injection).
*   [Ops] Cloud Scheduler 설정 (주기적 DNA 재합성 및 데이터 정리).

---

## 6. 성공 지표 (Success Metrics)

1.  **Collection Adoption**: 유저당 평균 생성 컬렉션 수 (목표: > 2.5개)
2.  **Search Relevance**: 컬렉션 기반 검색 결과의 클릭률(CTR) (목표: > 15% 상승)
3.  **DNA Quality**: 합성된 DNA의 평균 신뢰도 점수 (목표: > 85점)
4.  **Retention**: "내 스타일" 자산화에 따른 재방문율 증가 (목표: > 20% 상승)

---

## 7. 결론 (Conclusion)
본 PRD는 `dysprototype`을 단순 도구에서 **"개인화된 디자인 파트너"**로 격상시키는 청사진입니다. **Style Collection**과 **Synthesized DNA** 기술은 유저가 자신의 디자인 자산을 체계적으로 관리하고 활용하게 함으로써 강력한 Lock-in 효과를 창출할 것입니다.
